import{r as p,w as de,o as q,c as f,a as o,b as e,F as L,d as z,e as O,f as F,g as X,v as ct,t as C,h as y,i as M,j as se,k as Y,l as ut,m as dt,n as vt,T as ze,p as Q,q as be,s as te,u as ae,x as ve,y as mt,z as ee,A as gt,B as pt,C as Z,D as ft,E as ht,P as kt,G as bt,H as yt}from"./vue-BQqaqgFu.js";import{p as wt,G as _t,g as Ct}from"./pdfjs-0TcqIpea.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))u(v);new MutationObserver(v=>{for(const g of v)if(g.type==="childList")for(const d of g.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&u(d)}).observe(document,{childList:!0,subtree:!0});function l(v){const g={};return v.integrity&&(g.integrity=v.integrity),v.referrerPolicy&&(g.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?g.credentials="include":v.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function u(v){if(v.ep)return;v.ep=!0;const g=l(v);fetch(v.href,g)}})();const W=(k,n)=>{const l=k.__vccOpts||k;for(const[u,v]of n)l[u]=v;return l},$t={class:"modal-container"},It={class:"modal-body"},Tt={class:"settings-section"},Bt={class:"language-options"},St=["value"],xt={__name:"SettingsModal",emits:["close"],setup(k,{emit:n}){const l=p("zh-Hans"),u=n,v=p([{label:"简体中文",value:"zh-Hans",font:"SC_Font"},{label:"繁體中文",value:"zh-Hant",font:"TC_Font"},{label:"English",value:"en",font:"EN_Font"},{label:"日本語",value:"jp",font:"JP_Font"}]);de(l,d=>{const i=v.value.find($=>$.value===d).font;document.documentElement.style.setProperty("--main-font",i),localStorage.setItem("selectedLanguage",d),localStorage.setItem("selectedFont",i)}),q(()=>{const d=localStorage.getItem("selectedLanguage");d&&(l.value=d)});const g=()=>{u("close")};return(d,i)=>(o(),f("div",{class:"modal-mask",onClick:O(g,["self"])},[e("div",$t,[e("div",{class:"modal-header"},[i[1]||(i[1]=e("h3",null,"设置",-1)),e("button",{class:"close-btn",onClick:g},"×")]),e("div",It,[e("div",Tt,[i[2]||(i[2]=e("h4",null,"语言设置",-1)),e("div",Bt,[(o(!0),f(L,null,z(v.value,$=>(o(),f("label",{key:$.value},[F(e("input",{type:"radio","onUpdate:modelValue":i[0]||(i[0]=P=>l.value=P),value:$.value},null,8,St),[[ct,l.value]]),X(" "+C($.label),1)]))),128))])]),i[3]||(i[3]=e("div",{class:"settings-section"},[e("h4",null,"账户设置"),e("div",{class:"placeholder"},[e("p",null,"功能开发中...")])],-1))])])]))}},jt=W(xt,[["__scopeId","data-v-6a1fc317"]]),Mt={id:"welcome-screen",class:"screen"},At={class:"container"},Lt={__name:"WelcomeScreen",setup(k){const n=p(!1);return(l,u)=>(o(),f("section",Mt,[e("button",{class:"settings-btn",onClick:u[0]||(u[0]=v=>n.value=!0)},u[4]||(u[4]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z",stroke:"currentColor","stroke-width":"2"}),e("path",{d:"M19.4 15C18.85 13.75 18.85 12.25 19.4 11L21.5 7.5C19.5 5.25 16.5 4 13.4 4L10.6 4C7.5 4 4.5 5.25 2.5 7.5L4.6 11C5.15 12.25 5.15 13.75 4.6 15L2.5 18.5C4.5 20.75 7.5 22 10.6 22L13.4 22C16.5 22 19.5 20.75 21.5 18.5L19.4 15Z",stroke:"currentColor","stroke-width":"2"})],-1)])),e("div",At,[u[5]||(u[5]=e("h1",null,"言葉瞳1.0",-1)),u[6]||(u[6]=e("p",{class:"subtitle"},"努力开发中...",-1)),e("button",{id:"start-btn",class:"anime-btn",onClick:u[1]||(u[1]=v=>l.$emit("start"))},"多体讨论"),e("button",{id:"quick-chat-btn",class:"anime-btn",onClick:u[2]||(u[2]=v=>l.$emit("quick-chat"))},"分体聊天")]),n.value?(o(),y(jt,{key:0,onClose:u[3]||(u[3]=v=>n.value=!1)})):M("",!0)]))}},Et=W(Lt,[["__scopeId","data-v-c151fdc4"]]),Ot={class:"thinking-indicator"},Ft=["src"],Pt={class:"thinking-time"},Ut={__name:"ThinkingIndicator",props:["show","avatar","time"],setup(k){return(n,l)=>F((o(),f("div",Ot,[e("img",{src:k.avatar,class:"thinking-avatar",alt:"Agent Avatar"},null,8,Ft),l[0]||(l[0]=e("span",{class:"thinking-text"},"正在努力思考中 ~ 🧠",-1)),e("span",Pt,C(k.time),1)],512)),[[se,k.show]])}},Rt=W(Ut,[["__scopeId","data-v-29c675a2"]]),Ht=["id"],Jt={key:0,class:"file-modal"},qt={class:"modal-content"},zt=["src"],Dt=["placeholder"],Nt={class:"lefttop-container"},Wt={class:"lefttop-first-container"},Gt={class:"lefttop-second-container"},Vt={class:"session-sidebar"},Qt={class:"sessions-header"},Kt={key:0,class:"bg-options-menu"},Zt={class:"sessions-list-container"},Xt={class:"sessions-list"},Yt=["onClick"],es={class:"session-time"},ts=["onClick"],ss={class:"righttop-container"},as={class:"chat-container"},ns={key:0,class:"message user-message fade-in"},os={key:0,class:"attached-files"},ls={class:"user-message-content",style:{"white-space":"pre-wrap"}},is={key:1,class:"agent-message-with-avatar fade-in"},rs=["src"],cs={class:"agent-message-bubble stream-container"},us=["innerHTML"],ds=["onClick"],vs={key:0,class:"file-previews"},ms={class:"card-header"},gs={class:"file-meta"},ps={class:"file-name"},fs={class:"file-size"},hs={class:"file-actions"},ks=["onClick"],bs=["onClick"],ys=["onClick"],ws={class:"input-area"},_s=["onKeypress","disabled"],Cs={class:"input-tools"},$s=["disabled"],Is={key:0,class:"fas fa-pause"},Ts={key:1,class:"fas fa-comments"},Bs={key:2,class:"fas fa-paper-plane"},Ss="https://hc.1343263.xyz/api/process",xs={__name:"BaseChat",props:{chatId:String,chatTitle:String,defaultBg:String,avatarPath:String,mode:String,selectedAgents:{type:Array,default:()=>[]}},emits:["back"],setup(k,{expose:n,emit:l}){_t.workerSrc=wt;const u=p(!1),v=p(null),g=p(""),d=p(!0),i=k,$=p(!1),P=p("#ffffff"),_=s=>{J.value.startsWith("blob:")&&URL.revokeObjectURL(J.value),document.getElementById(i.chatId).style.backgroundImage="none",document.getElementById(i.chatId).style.backgroundColor=s,localStorage.setItem(`${i.chatId}-bg-type`,"color"),localStorage.setItem(`${i.chatId}-bg`,s),J.value=s,$.value=!1},I=s=>{const t=document.querySelector(".bg-options-menu"),r=document.querySelector(".color-picker-container");!t.contains(s.target)&&!r.contains(s.target)&&($.value=!1)};q(()=>{document.addEventListener("click",I)}),Y(()=>{document.removeEventListener("click",I)});const S=()=>{H.value?ye():fe()},ye=()=>{if(u.value=!0,v.value){v.value.abort(),v.value=null;const t=w[j.value].messages.findLast(r=>r.sender==="agent"&&!r.finished);t&&(t.finished=!0,t.html=Z.parse(t.content))}g.value=""},De=()=>{u.value=!1,fe(g.value)},D=ut("showToast"),we=p(null),_e=p(!1),U=p(i.mode),A=p([i.avatarPath]),K=p(0),x=p([]),R=p(""),H=p(!1),G=p("0.0s"),Ce=p(null),w=dt([]),j=p(0),T=p(null),me=p(!0),Ne=p(null),ne=p(!1),$e=p(""),ge=p(""),oe=p(""),pe=p(-1),le=p(!1),J=p(i.defaultBg),Ie=p(null),We=p(i.defaultBg),Te=vt(()=>`${i.chatId}-sessions`),Ge=()=>{try{const s=localStorage.getItem(Te.value);s&&(w.splice(0,w.length,...JSON.parse(s).map(t=>({...t,startTime:new Date(t.startTime),messages:t.messages.map(r=>({...r,timestamp:r.timestamp?new Date(r.timestamp):new Date}))}))),j.value=w.length>0?0:-1)}catch(s){console.error("读取会话失败:",s)}},Be=()=>{try{const s=w.map(t=>({...t,startTime:t.startTime.getTime(),messages:t.messages.map(r=>{var a;return{...r,timestamp:((a=r.timestamp)==null?void 0:a.getTime())||Date.now()}})}));localStorage.setItem(Te.value,JSON.stringify(s))}catch(s){console.error("保存会话失败:",s)}},Ve=()=>{localStorage.removeItem(`${i.chatId}-bg`),ie(i.defaultBg),D("已恢复默认背景")},ie=s=>{document.getElementById(i.chatId).style.backgroundColor="",J.value.startsWith("blob:")&&URL.revokeObjectURL(J.value),J.value=s,document.getElementById(i.chatId).style.backgroundImage=`url(${s})`,localStorage.setItem(`${i.chatId}-bg-type`,"image")},Qe=()=>{Ie.value.click()},Ke=s=>{const t=s.target.files[0];if(t){const r=new FileReader;r.onload=a=>{const m=a.target.result;ie(m),localStorage.setItem(`${i.chatId}-bg`,m)},r.readAsDataURL(t)}};Y(()=>{J.value.startsWith("blob:")&&URL.revokeObjectURL(J.value)}),q(()=>{const s=localStorage.getItem(`${i.chatId}-bg-type`),t=localStorage.getItem(`${i.chatId}-bg`);t?s==="color"?(document.getElementById(i.chatId).style.backgroundColor=t,document.getElementById(i.chatId).style.backgroundImage="none"):ie(t):ie(We.value)});const Ze=()=>{ne.value=!1,ge.value.startsWith("blob:")&&URL.revokeObjectURL(ge.value)},Xe=s=>{const t=URL.createObjectURL(s.raw),r=window.open(t,"_blank");setTimeout(()=>{if(!r||r.closed){D("请在浏览器设置中允许弹出窗口，或长按链接选择打开方式");const a=document.createElement("a");a.href=t,a.download=s.name,document.body.appendChild(a),a.click(),document.body.removeChild(a)}},500),r==null||r.addEventListener("beforeunload",()=>{URL.revokeObjectURL(t)})},Ye=(s,t)=>{const a=[];for(let c=0;c<s.length;c+=100)a.push(s.slice(c,c+100));const m=document.createDocumentFragment();return a.forEach(c=>{const h=document.createElement("span");h.textContent=c,m.appendChild(h)}),{safeContent:t+s,buffer:"",hasPendingCode:!1}},et=(s,t)=>{oe.value=s.content,pe.value=t,$e.value=`编辑内容 - ${s.name}`,le.value=!1,ne.value=!0},tt=()=>{pe.value>=0&&(x.value[pe.value].content=oe.value,ne.value=!1,D("修改已保存"))};q(async()=>{await ze.createWorker(),_e.value=!0}),Y(async()=>{we.value&&await we.value.terminate()}),q(()=>{T.value&&T.value.addEventListener("scroll",re),w.length===0&&V()}),Y(()=>{T.value&&T.value.removeEventListener("scroll",re)});const Se=async(s,t)=>{try{if(s.type.startsWith("image/")){if(!_e.value)throw new Error("OCR引擎初始化中，请稍后");const{data:{text:m}}=await ze.recognize(s);return m}if(s.type==="application/pdf"){const c=await Ct({data:new Uint8Array(t)}).promise;let h="";for(let b=1;b<=c.numPages;b++){const ue=await(await c.getPage(b)).getTextContent();h+=ue.items.map(B=>B.str).join(`
`)+`
`}return h}if(s.name.endsWith(".docx"))return(await ht.extractRawText({arrayBuffer:t})).value.replace(/\n{3,}/g,`

`);if(s.name.endsWith(".pptx")){const m=new kt;return await m.load(t),m.slides.flatMap(c=>c.shapes.filter(h=>h.text).map(h=>h.text)).join(`

`)}const r=["utf-8","gbk","gb2312","big5","shift_jis","windows-1252"];let a="";for(const m of r)try{if(a=new TextDecoder(m,{fatal:!0}).decode(new Uint8Array(t)),!st(a))return a}catch{continue}return a.replace(/[^\x00-\x7F]/g,"")}catch(r){throw console.error("文件解析错误:",r),new Error(`文件解析失败: ${r.message}`)}},st=s=>/[\x00-\x08\x0B-\x0C\x0E-\x1F]/.test(s),xe=s=>{if(s===0)return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,a)).toFixed(2))+" "+r[a]},je=async s=>{const t=Array.from(s.target.files);for(const r of t)try{const a={name:r.name,size:r.size,content:"",raw:r,icon:Ae(r.name),progress:0,status:"解析中...",isExpanded:!1};x.value.push(a);const m=await Me(r,c=>{a.progress=Math.floor(c*100)});a.content=m,a.status="解析完成",a.progress=100}catch(a){fileItem.status=`解析失败: ${a.message}`,fileItem.progress=0,D(`${r.name} 处理失败: ${a.message}`)}s.target.value=""},Me=(s,t)=>new Promise((r,a)=>{const m=new FileReader;let c=0;m.onprogress=h=>{if(h.lengthComputable){const b=h.loaded/h.total;b-c>.05&&(t==null||t(b),c=b)}},m.onload=async h=>{try{const b=await Se(s,h.target.result);r(b)}catch(b){a(b)}},m.onerror=a,m.readAsArrayBuffer(s)}),Ae=s=>{const t=s.split(".").pop().toLowerCase();return`fas ${{pdf:"fa-file-pdf",jpg:"fa-file-image",png:"fa-file-image",doc:"fa-file-word",docx:"fa-file-word",ppt:"fa-file-powerpoint",pptx:"fa-file-powerpoint",txt:"fa-file-alt"}[t]||"fa-file"}`},Le=s=>{x.value.splice(s,1)};function V(){w.push({id:w.length,messages:[],startTime:new Date,avatar:A.value[K.value]}),j.value=w.length-1,Q(ce)}function Ee(s){j.value=s,Q(ce)}function Oe(s){return/```[\s\S]*?```/g.test(s)}function Fe(s){const t=s.match(/```[\s\S]*?```/g);return t?t.map(r=>r.replace(/```[\s\S]*?\n/,"").replace(/```$/,"")):[]}async function Pe(s){try{await navigator.clipboard.writeText(s),D("代码已复制到剪贴板！")}catch{D("复制失败，请手动选择复制")}}async function Ue(s=""){if(u.value){De();return}const t=w[j.value],r=t.messages.flatMap(c=>{var b;const h=c.sender==="user"?{role:"user",content:c.content+((b=c.files)!=null&&b.length?`
[附件内容]
`+c.files.map(N=>N.content).join(`
`):"")}:{role:"assistant",content:c.content};return i.selectedAgents.length>=2?[h]:c.sender==="user"?[h]:[]});let a="";if(i.selectedAgents.length>1)a=r.map(c=>`${c.role==="user"?"[用户]":`[${U.value}]`} ${c.content}`).join(`

`);else{const c=R.value.trim(),h=x.value.map(b=>b.content.trim()).join(`

`);a=[c,h].filter(b=>b.length>0).join(`

`)}if(!a.trim()){D("请输入内容或上传文件");return}!s&&i.selectedAgents.length<2&&t.messages.push({sender:"user",content:R.value,files:[...x.value]}),v.value=new AbortController,H.value=!0,u.value=!1;let m=s;at();try{const c=await fetch(Ss,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inputText:a,agentMode:U.value,history:r,currentAgent:U.value}),signal:v.value.signal});if(!c.ok)throw new Error(await c.text());const h=c.body.getReader(),b=new TextDecoder;let N="",ue=!0,B=null,Re="",He=!1;for(;!u.value;){const{done:lt,value:it}=await h.read();if(lt)break;N+=b.decode(it,{stream:!0});const Je=N.split(`
`);N=Je.pop()||"";for(const qe of Je){if(!qe.trim())continue;const he=JSON.parse(qe);if(he.error)throw new Error(he.error);const ke=Ye(he.content,Re),rt=ke.safeContent;Re=ke.buffer,He=ke.hasPendingCode,ue&&(B={sender:"agent",content:"",html:'<span class="blinking-cursor">|</span>',avatar:A.value[K.value],finished:!1,agentMode:U.value},t.messages.push(B),ue=!1),m+=rt,g.value=m,B.content=m,He?B.html=Z.parse(m+"```")+'<span class="blinking-cursor">|</span><div class="pending-code">代码生成中...</div>':(B.html=Z.parse(m)+'<span class="blinking-cursor">|</span>',window.MathJax&&window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,T.value])),await Q(),ce(),window.MathJax&&window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,T.value])}}B&&(typeof m=="string"&&(B.html=Z.parse(m).replace('<span class="blinking-cursor">|</span>',""),B.content=m,B.rawContent=m),B.time=G.value,B.finished=!0)}catch(c){c.name!=="AbortError"||console.log("请求已中止")}finally{i.selectedAgents.length<2&&(R.value="",x.value=[]),ot(),H.value=!1,v.value=null,g.value="",await Q(),u.value=!1,window.MathJax&&window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,T.value])}}async function fe(){if(i.selectedAgents.length>=2){const s=w[j.value];s.messages.push({sender:"user",content:R.value,files:[...x.value]});let t=[...s.messages];for(let r=0;r<i.selectedAgents.length;r++){U.value=i.selectedAgents[r];const a=`/avatar/${U.value}.jpg`;A.value.includes(a)||(A.value=[a]),K.value=A.value.indexOf(a),t.map(c=>({role:c.sender==="user"?"user":"assistant",content:c.sender==="agent"?c.rawContent:c.content})),await Ue("");const m=s.messages[s.messages.length-1];t.push(m)}}else{if(i.selectedAgents.length==1){U.value=i.selectedAgents[0];const s=`/NJUtianchiAICabbageTeam/avatar/${U.value}.jpg`;A.value.includes(s)||(A.value=[s]),K.value=A.value.indexOf(s)}Ue()}R.value="",x.value=[]}function at(){let s=Date.now();G.value="0.0s",Ce.value=setInterval(()=>{G.value=((Date.now()-s)/1e3).toFixed(1)+"s"},100)}function nt(s){w.length>1?j.value=s>0?s-1:0:V(),w.splice(s,1),w.length===0&&V(),Be()}function ot(){clearInterval(Ce.value),G.value="0.0s"}function re(){const s=T.value;s&&(me.value=s.scrollHeight-s.scrollTop-s.clientHeight<2)}const ce=()=>{if(!T.value||!me.value)return;const s=T.value;requestAnimationFrame(()=>{s.scrollTop=s.scrollHeight})};return de(()=>w,s=>{Be()},{deep:!0}),q(()=>{Ge(),w.length===0&&V()}),de(()=>{var s;return(s=w[j.value])==null?void 0:s.messages.length},async()=>{await Q(),window.MathJax&&T.value&&window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,T.value])}),n({isThinking:H,thinkingTime:G,sessions:w,activeSessionIndex:j,chatHistoryRef:T,files:x,inputText:R,handleFileUpload:je,removeFile:Le,createNewChat:V,switchToSession:Ee,scrollToBottom:ce,formatFileSize:xe,getFileIcon:Ae,parseAnyFile:Se,readFileContent:Me,hasCodeBlocks:Oe,getCodeBlocks:Fe,copyToClipboard:Pe,onChatHistoryScroll:re,autoScroll:me}),(s,t)=>{var r;return o(),f("section",{id:k.chatId,class:"screen"},[ne.value?(o(),f("div",Jt,[e("div",qt,[e("span",{class:"close",onClick:Ze},"×"),e("h3",null,C($e.value),1),le.value?(o(),f("img",{key:0,src:ge.value,class:"file-preview-image"},null,8,zt)):F((o(),f("textarea",{key:1,"onUpdate:modelValue":t[0]||(t[0]=a=>oe.value=a),class:"file-content-editor",placeholder:le.value?"图片不可编辑":"在此编辑文件内容"},null,8,Dt)),[[be,oe.value]]),le.value?M("",!0):(o(),f("button",{key:2,class:"anime-btn save-btn",onClick:tt}," 保存 "))])])):M("",!0),e("div",Nt,[e("div",Wt,[e("button",{class:"anime-btn back-btn",onClick:t[1]||(t[1]=a=>s.$emit("back"))},t[10]||(t[10]=[e("i",{class:"fas fa-arrow-left"},null,-1)]))]),e("div",Gt,[F(e("button",{class:"expand-btn",onClick:t[2]||(t[2]=a=>d.value=!d.value)},t[11]||(t[11]=[e("i",{class:"fas fa-chevron-right"},null,-1)]),512),[[se,d.value]])]),te(ve,{name:"slide"},{default:ae(()=>[F(e("div",Vt,[e("div",Qt,[t[19]||(t[19]=e("h3",null,"历史",-1)),e("button",{class:"anime-btn",onClick:V},t[12]||(t[12]=[e("i",{class:"fas fa-plus"},null,-1)])),e("button",{class:"anime-btn",onClick:t[3]||(t[3]=O(a=>$.value=!$.value,["stop"])),title:"背景设置"},t[13]||(t[13]=[e("i",{class:"fas fa-palette"},null,-1)])),te(ve,{name:"fade"},{default:ae(()=>[$.value?(o(),f("div",Kt,[e("div",{class:"bg-option",onClick:Qe},[t[14]||(t[14]=e("i",{class:"fas fa-image"},null,-1)),t[15]||(t[15]=X(" 自定义背景 ")),e("input",{type:"file",ref_key:"bgInput",ref:Ie,accept:"image/*",onChange:Ke,style:{display:"none"}},null,544)]),e("div",{class:"bg-option",onClick:Ve},t[16]||(t[16]=[e("i",{class:"fas fa-undo"},null,-1),X(" 恢复默认 ")])),e("div",{class:"color-picker-container",onClick:t[6]||(t[6]=O(()=>{},["stop"]))},[F(e("input",{type:"color","onUpdate:modelValue":t[4]||(t[4]=a=>P.value=a),onInput:t[5]||(t[5]=O(a=>_(P.value),["stop"])),class:"color-picker"},null,544),[[be,P.value]]),e("div",{class:"color-preview",style:mt({background:P.value})},null,4),t[17]||(t[17]=X(" 自定义颜色 "))])])):M("",!0)]),_:1}),e("button",{class:"collapse-btn",onClick:t[7]||(t[7]=a=>d.value=!d.value)},t[18]||(t[18]=[e("i",{class:"fas fa-chevron-left"},null,-1)]))]),e("div",Zt,[e("div",Xt,[(o(!0),f(L,null,z(w,(a,m)=>{var c,h;return o(),f("div",{key:a.id,class:ee(["session-item",{active:m===j.value}]),onClick:b=>Ee(m)},[e("div",null," 会话 "+C(m+1)+": "+C((h=(c=a.messages[a.messages.length-1])==null?void 0:c.content)==null?void 0:h.slice(0,20)),1),e("div",es,C(a.startTime.toLocaleTimeString()),1),e("button",{class:"delete-session-btn",title:"清空本会话",onClick:O(b=>nt(m),["stop"])},t[20]||(t[20]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,ts)],10,Yt)}),128))])])],512),[[se,!d.value]])]),_:1})]),e("div",ss,[gt(s.$slots,"righttop",{},void 0)]),e("h1",null,C(k.chatTitle),1),t[26]||(t[26]=e("div",{class:"leftbottom-container"},null,-1)),e("div",as,[te(Rt,{show:H.value,avatar:A.value[K.value],time:G.value},null,8,["show","avatar","time"]),e("div",{class:"chat-history",ref_key:"chatHistoryRef",ref:T,onScroll:re},[(o(!0),f(L,null,z((r=w[j.value])==null?void 0:r.messages,(a,m)=>{var c;return o(),f(L,{key:m},[a.sender==="user"?(o(),f("div",ns,[(c=a.files)!=null&&c.length?(o(),f("div",os,[(o(!0),f(L,null,z(a.files,(h,b)=>(o(),f("div",{key:b,class:"file-tag"},[e("i",{class:ee(h.icon)},null,2),X(" "+C(h.name),1)]))),128))])):M("",!0),e("div",ls,C(a.content),1)])):(o(),f("div",is,[e("img",{src:a.avatar||A.value[0],class:"agent-avatar"},null,8,rs),e("div",cs,[e("div",{class:"stream-content",innerHTML:a.rawContent?pt(Z).parse(a.rawContent):a.html},null,8,us),Oe(a.content)?(o(!0),f(L,{key:0},z(Fe(a.content),(h,b)=>(o(),f("div",{class:"code-copy-container",key:b},[e("pre",null,[e("code",null,C(h),1)]),e("button",{class:"copy-btn",onClick:N=>Pe(h),title:"复制代码"},t[21]||(t[21]=[e("i",{class:"fas fa-copy"},null,-1)]),8,ds)]))),128)):M("",!0)])]))],64)}),128))],544),x.value.length>0?(o(),f("div",vs,[(o(!0),f(L,null,z(x.value,(a,m)=>(o(),f("div",{key:m,class:ee(["file-card",{expanded:a.isExpanded}])},[e("div",ms,[e("i",{class:ee(a.icon)},null,2),e("div",gs,[e("span",ps,C(a.name),1),e("span",fs,C(xe(a.size)),1)]),e("div",hs,[e("button",{class:"action-btn view-btn",onClick:O(c=>Xe(a),["stop"])},t[22]||(t[22]=[e("i",{class:"fas fa-eye"},null,-1)]),8,ks),e("button",{class:"action-btn edit-btn",onClick:O(c=>et(a,m),["stop"])},t[23]||(t[23]=[e("i",{class:"fas fa-edit"},null,-1)]),8,bs),e("button",{class:"action-btn delete-btn",onClick:O(c=>Le(m),["stop"])},t[24]||(t[24]=[e("i",{class:"fas fa-times"},null,-1)]),8,ys)])])],2))),128))])):M("",!0),e("div",ws,[F(e("textarea",{id:"text-input-field","onUpdate:modelValue":t[8]||(t[8]=a=>R.value=a),placeholder:"请输入...",onKeypress:ft(O(fe,["prevent"]),["enter"]),disabled:H.value},null,40,_s),[[be,R.value]]),e("div",Cs,[e("input",{type:"file",class:"tool-btn",style:{display:"none"},ref_key:"fileInput",ref:Ne,onChange:je,multiple:"",accept:"*/*"},null,544),e("button",{class:"tool-btn",onClick:t[9]||(t[9]=a=>s.$refs.fileInput.click()),disabled:H.value},t[25]||(t[25]=[e("i",{class:"fas fa-file-upload"},null,-1)]),8,$s),e("button",{class:"tool-btn",onClick:S},[H.value?(o(),f("i",Is)):k.selectedAgents.length>=2?(o(),f("i",Ts)):(o(),f("i",Bs))])])])])],8,Ht)}}},E=W(xs,[["__scopeId","data-v-b5c37a05"]]),js={class:"agent-sidebar"},Ms={class:"sessions-header"},As={class:"sidebar-header-row"},Ls={class:"agent-list"},Es=["onClick"],Os=["src"],Fs={key:0,class:"selected-indicator"},Ps={class:"agent-info"},Us={class:"agent-name"},Rs={class:"agent-mode"},Hs={key:1,class:"fas fa-check selected-icon"},Js={__name:"GroupDiscussionChat",emits:["back"],setup(k,{emit:n}){const l=p(!0);function u(){l.value=!l.value}const v=p(null),g=p([]),d=p([{mode:"soul",name:"心灵导师",avatar:"/avatar/soul.jpg"},{mode:"misheard",name:"空耳专家",avatar:"/avatar/misheard.jpg"},{mode:"correction",name:"语法医生",avatar:"/avatar/correction.jpg"},{mode:"stem",name:"科学大家",avatar:"/avatar/stem.jpg"},{mode:"culture",name:"文化学者",avatar:"/avatar/culture.jpg"},{mode:"dialect",name:"方言达人",avatar:"/avatar/dialect.jpg"},{mode:"super-translate",name:"翻译大师",avatar:"avatar/super-translate.jpg"},{mode:"game-misheard",name:"空耳游戏王",avatar:"avatar/game-misheard.jpg"},{mode:"game-word",name:"字词专家",avatar:"/avatar/game-word.jpg"}]),i=p(new AbortController),$=_=>g.value.includes(_),P=_=>{const I=g.value.indexOf(_);I>-1?g.value.splice(I,1):g.value.length<9&&g.value.push(_),g.value=[...g.value],v.value.selectedAgents=[...g.value]};return q(()=>{Q(()=>{var _,I;((I=(_=v.value)==null?void 0:_.sessions)==null?void 0:I.length)===0&&v.value.createNewChat()})}),Y(()=>{var _;(_=i.value)==null||_.abort()}),de(g,_=>{localStorage.setItem("group-selected-agents",JSON.stringify(_))}),q(()=>{const _=localStorage.getItem("group-selected-agents");_&&(g.value=JSON.parse(_),v.value.selectedAgents=[...g.value])}),(_,I)=>(o(),y(E,{ref_key:"baseChat",ref:v,chatId:"group-discussion",chatTitle:"多体讨论 ("+g.value.length+"/9)",defaultBg:"/bg/groupdiscussion-bg.jpg",mode:"zero",selectedAgents:g.value,avatarPath:"/avatar/zero.gif",onBack:I[0]||(I[0]=S=>_.$emit("back"))},{righttop:ae(()=>[te(ve,{name:"slide"},{default:ae(()=>[F(e("div",js,[e("div",Ms,[e("div",As,[e("button",{class:"collapse-btn",onClick:u},I[1]||(I[1]=[e("i",{class:"fas fa-chevron-right"},null,-1)])),e("h2",null,"讨论成员（"+C(g.value.length)+"/9）",1)])]),e("div",Ls,[(o(!0),f(L,null,z(d.value,S=>(o(),f("div",{key:S.mode,class:ee(["agent-item",{selected:$(S.mode)}]),onClick:ye=>P(S.mode)},[e("img",{src:S.avatar,class:"agent-avatar"},null,8,Os),$(S.mode)?(o(),f("div",Fs)):M("",!0),e("div",Ps,[e("span",Us,C(S.name),1),e("span",Rs,C(S.mode),1)]),$(S.mode)?(o(),f("i",Hs)):M("",!0)],10,Es))),128))])],512),[[se,!l.value]])]),_:1}),F(e("button",{class:"expand-btn",onClick:u},I[2]||(I[2]=[e("i",{class:"fas fa-chevron-left"},null,-1)]),512),[[se,l.value]])]),_:1},8,["chatTitle","selectedAgents"]))}},qs=W(Js,[["__scopeId","data-v-0b22ca09"]]),zs={__name:"SoulChat",setup(k){return(n,l)=>(o(),y(E,{chatId:"soul-chat",chatTitle:"心灵空间",defaultBg:"/bg/soul-bg.jpg",avatarPath:"/avatar/soul.jpg",mode:"soul",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},Ds={__name:"MisheardChat",setup(k){return(n,l)=>(o(),y(E,{chatId:"misheard-chat",chatTitle:"空耳查询",defaultBg:"/bg/misheard-bg.jpg",avatarPath:"/avatar/misheard.jpg",mode:"misheard",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},Ns={__name:"CorrectionChat",setup(k){return(n,l)=>(o(),y(E,{chatId:"correction-chat",chatTitle:"语言纠错",defaultBg:"/bg/correction-bg.jpg",avatarPath:"/avatar/correction.jpg",mode:"correction",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},Ws={class:"toast show"},Gs={class:"toast-content"},Vs={__name:"Toast",props:["message"],setup(k){return(n,l)=>(o(),f("div",Ws,[e("div",Gs,C(k.message),1)]))}},Qs=W(Vs,[["__scopeId","data-v-9f189b94"]]),Ks={__name:"GameMisheardChat",setup(k){return(n,l)=>(o(),y(E,{chatId:"game-misheard-chat",chatTitle:"空耳挑战",defaultBg:"/bg/game-misheard-bg.jpg",avatarPath:"/avatar/game-misheard.jpg",mode:"game-misheard",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},Zs={__name:"GameWordChat",setup(k){return(n,l)=>(o(),y(E,{chatId:"game-word-chat",chatTitle:"字音快对",defaultBg:"/bg/game-word-bg.jpg",avatarPath:"/avatar/game-word.jpg",mode:"game-word",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},Xs={__name:"CultureChat",setup(k){return(n,l)=>(o(),y(E,{chatId:"culture-chat",chatTitle:"文化探索",defaultBg:"/bg/culture-bg.jpg",avatarPath:"/avatar/culture.jpg",mode:"culture",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},Ys={__name:"DialectChat",setup(k){return(n,l)=>(o(),y(E,{chatId:"dialect-chat",chatTitle:"方言探索",defaultBg:"/bg/dialect-bg.jpg",avatarPath:"/avatar/dialect.jpg",mode:"dialect",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},ea={__name:"SuperTranslateChat",setup(k){return(n,l)=>(o(),y(E,{chatId:"super-translate-chat",chatTitle:"超能翻译",defaultBg:"/bg/super-translate-bg.jpg",avatarPath:"/avatar/super-translate.jpg",mode:"super-translate",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},ta={class:"screen quick-chat-screen",id:"quick-chat"},sa={class:"lefttop-container"},aa={class:"chat-grid"},na=["onClick"],oa={class:"chat-icon"},la={class:"chat-title"},ia={__name:"QuickChatScreen",setup(k){const n=[{type:"soul",title:"心灵空间",icon:"💌"},{type:"misheard",title:"空耳查询",icon:"🎧"},{type:"correction",title:"语言纠错",icon:"📝"},{type:"dialect",title:"方言探索",icon:"🗺️"},{type:"super-translate",title:"超能翻译",icon:"🚀"},{type:"culture",title:"文化探索",icon:"🎎"},{type:"game-misheard",title:"空耳挑战",icon:"🎮"},{type:"game-word",title:"字音快对",icon:"🔠"},{type:"stem",title:"科学世界",icon:"🧪"}];return(l,u)=>(o(),f("section",ta,[e("div",sa,[e("button",{class:"anime-btn",onClick:u[0]||(u[0]=v=>l.$emit("back"))},u[1]||(u[1]=[e("i",{class:"fas fa-arrow-left"},null,-1)]))]),e("div",aa,[(o(),f(L,null,z(n,(v,g)=>e("div",{key:g,class:"chat-item anime-btn",onClick:d=>l.$emit("select-chat",v.type)},[e("div",oa,C(v.icon),1),e("div",la,C(v.title),1)],8,na)),64))])]))}},ra=W(ia,[["__scopeId","data-v-6a0862ae"]]),ca={__name:"STEMChat",setup(k){return(n,l)=>(o(),y(E,{chatId:"stem-chat",chatTitle:"科学世界",defaultBg:"/bg/stem-bg.jpg",avatarPath:"/avatar/stem.jpg",mode:"stem",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},ua={__name:"App",setup(k){const n=p("welcome"),l=p({show:!1,message:""}),u=g=>{n.value=g};function v(g){l.value={show:!0,message:g},setTimeout(()=>l.value.show=!1,3e3)}return bt("showToast",v),(g,d)=>(o(),f(L,null,[te(ve,{name:"anime-fade-cross"},{default:ae(()=>[n.value==="welcome"?(o(),y(Et,{onStart:d[0]||(d[0]=i=>n.value="group-discussion"),onQuickChat:d[1]||(d[1]=i=>n.value="quick-chat"),key:"welcome"})):n.value==="group-discussion"?(o(),y(qs,{key:1,onBack:d[2]||(d[2]=i=>n.value="welcome")})):n.value==="soul"?(o(),y(zs,{key:2,onBack:d[3]||(d[3]=i=>n.value="quick-chat")})):n.value==="misheard"?(o(),y(Ds,{key:3,onBack:d[4]||(d[4]=i=>n.value="quick-chat")})):n.value==="correction"?(o(),y(Ns,{key:4,onBack:d[5]||(d[5]=i=>n.value="quick-chat")})):n.value==="game-misheard"?(o(),y(Ks,{key:5,onBack:d[6]||(d[6]=i=>n.value="quick-chat")})):n.value==="game-word"?(o(),y(Zs,{key:6,onBack:d[7]||(d[7]=i=>n.value="quick-chat")})):n.value==="culture"?(o(),y(Xs,{key:7,onBack:d[8]||(d[8]=i=>n.value="quick-chat")})):n.value==="dialect"?(o(),y(Ys,{key:8,onBack:d[9]||(d[9]=i=>n.value="quick-chat")})):n.value==="super-translate"?(o(),y(ea,{key:9,onBack:d[10]||(d[10]=i=>n.value="quick-chat")})):n.value==="stem"?(o(),y(ca,{key:10,onBack:d[11]||(d[11]=i=>n.value="quick-chat")})):n.value==="quick-chat"?(o(),y(ra,{key:11,onBack:d[12]||(d[12]=i=>n.value="welcome"),onSelectChat:u})):M("",!0)]),_:1}),l.value.show?(o(),y(Qs,{key:0,message:l.value.message},null,8,["message"])):M("",!0)],64))}};yt(ua).mount("#app");
