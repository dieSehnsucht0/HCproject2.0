import{r as p,w as de,o as R,c as f,a as o,b as e,F as H,d as q,e as M,f as L,g as X,v as ct,t as w,h as _,i as U,j as ae,k as Y,l as ut,m as dt,n as vt,T as qe,p as Q,q as be,s as te,u as se,x as ve,y as mt,z as ee,A as gt,B as pt,C as Z,D as ft,E as ht,P as kt,G as bt,H as _t}from"./vue-DTVf9Rbc.js";import{p as yt,G as Ct,g as wt}from"./pdfjs-D3jeCzsy.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))u(v);new MutationObserver(v=>{for(const g of v)if(g.type==="childList")for(const d of g.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&u(d)}).observe(document,{childList:!0,subtree:!0});function l(v){const g={};return v.integrity&&(g.integrity=v.integrity),v.referrerPolicy&&(g.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?g.credentials="include":v.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function u(v){if(v.ep)return;v.ep=!0;const g=l(v);fetch(v.href,g)}})();const W=(k,n)=>{const l=k.__vccOpts||k;for(const[u,v]of n)l[u]=v;return l},$t={class:"modal-container"},It={class:"modal-body"},Tt={class:"settings-section"},Bt={class:"language-options"},St=["value"],xt={__name:"SettingsModal",emits:["close"],setup(k,{emit:n}){const l=p("zh-Hans"),u=n,v=p([{label:"简体中文",value:"zh-Hans",font:"SC_Font"},{label:"繁體中文",value:"zh-Hant",font:"TC_Font"},{label:"English",value:"en",font:"EN_Font"},{label:"日本語",value:"jp",font:"JP_Font"}]);de(l,d=>{const i=v.value.find($=>$.value===d).font;document.documentElement.style.setProperty("--main-font",i),localStorage.setItem("selectedLanguage",d),localStorage.setItem("selectedFont",i)}),R(()=>{const d=localStorage.getItem("selectedLanguage");d&&(l.value=d)});const g=()=>{u("close")};return(d,i)=>(o(),f("div",{class:"modal-mask",onClick:M(g,["self"])},[e("div",$t,[e("div",{class:"modal-header"},[i[1]||(i[1]=e("h3",null,"设置",-1)),e("button",{class:"close-btn",onClick:g},"×")]),e("div",It,[e("div",Tt,[i[2]||(i[2]=e("h4",null,"语言设置",-1)),e("div",Bt,[(o(!0),f(H,null,q(v.value,$=>(o(),f("label",{key:$.value},[L(e("input",{type:"radio","onUpdate:modelValue":i[0]||(i[0]=N=>l.value=N),value:$.value},null,8,St),[[ct,l.value]]),X(" "+w($.label),1)]))),128))])]),i[3]||(i[3]=e("div",{class:"settings-section"},[e("h4",null,"账户设置"),e("div",{class:"placeholder"},[e("p",null,"功能开发中...")])],-1))])])]))}},At=W(xt,[["__scopeId","data-v-6a1fc317"]]),Ut={id:"welcome-screen",class:"screen"},jt={class:"container"},Ht={__name:"WelcomeScreen",setup(k){const n=p(!1);return(l,u)=>(o(),f("section",Ut,[e("button",{class:"settings-btn",onClick:u[0]||(u[0]=v=>n.value=!0)},u[4]||(u[4]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z",stroke:"currentColor","stroke-width":"2"}),e("path",{d:"M19.4 15C18.85 13.75 18.85 12.25 19.4 11L21.5 7.5C19.5 5.25 16.5 4 13.4 4L10.6 4C7.5 4 4.5 5.25 2.5 7.5L4.6 11C5.15 12.25 5.15 13.75 4.6 15L2.5 18.5C4.5 20.75 7.5 22 10.6 22L13.4 22C16.5 22 19.5 20.75 21.5 18.5L19.4 15Z",stroke:"currentColor","stroke-width":"2"})],-1)])),e("div",jt,[u[5]||(u[5]=e("h1",null,"言葉瞳1.0",-1)),u[6]||(u[6]=e("p",{class:"subtitle"},"努力开发中...",-1)),e("button",{id:"start-btn",class:"anime-btn",onClick:u[1]||(u[1]=v=>l.$emit("start"))},"多体讨论"),e("button",{id:"quick-chat-btn",class:"anime-btn",onClick:u[2]||(u[2]=v=>l.$emit("quick-chat"))},"分体聊天")]),n.value?(o(),_(At,{key:0,onClose:u[3]||(u[3]=v=>n.value=!1)})):U("",!0)]))}},Jt=W(Ht,[["__scopeId","data-v-c151fdc4"]]),Mt={class:"thinking-indicator"},Lt=["src"],Nt={class:"thinking-time"},Et={__name:"ThinkingIndicator",props:["show","avatar","time"],setup(k){return(n,l)=>L((o(),f("div",Mt,[e("img",{src:k.avatar,class:"thinking-avatar",alt:"Agent Avatar"},null,8,Lt),l[0]||(l[0]=e("span",{class:"thinking-text"},"正在努力思考中 ~ 🧠",-1)),e("span",Nt,w(k.time),1)],512)),[[ae,k.show]])}},Ot=W(Et,[["__scopeId","data-v-29c675a2"]]),Ft=["id"],Pt={key:0,class:"file-modal"},Rt={class:"modal-content"},qt=["src"],zt=["placeholder"],Dt={class:"lefttop-container"},Wt={class:"lefttop-first-container"},Gt={class:"lefttop-second-container"},Vt={class:"session-sidebar"},Qt={class:"sessions-header"},Kt={key:0,class:"bg-options-menu"},Zt={class:"sessions-list-container"},Xt={class:"sessions-list"},Yt=["onClick"],ea={class:"session-time"},ta=["onClick"],aa={class:"righttop-container"},sa={class:"chat-container"},na={key:0,class:"message user-message fade-in"},oa={key:0,class:"attached-files"},la={class:"user-message-content",style:{"white-space":"pre-wrap"}},ia={key:1,class:"agent-message-with-avatar fade-in"},ra=["src"],ca={class:"agent-message-bubble stream-container"},ua=["innerHTML"],da=["onClick"],va={key:0,class:"file-previews"},ma={class:"card-header"},ga={class:"file-meta"},pa={class:"file-name"},fa={class:"file-size"},ha={class:"file-actions"},ka=["onClick"],ba=["onClick"],_a=["onClick"],ya={class:"input-area"},Ca=["onKeypress","disabled"],wa={class:"input-tools"},$a=["disabled"],Ia={key:0,class:"fas fa-pause"},Ta={key:1,class:"fas fa-comments"},Ba={key:2,class:"fas fa-paper-plane"},Sa="https://hc.1343263.xyz/api/process",xa={__name:"BaseChat",props:{chatId:String,chatTitle:String,defaultBg:String,avatarPath:String,mode:String,selectedAgents:{type:Array,default:()=>[]}},emits:["back"],setup(k,{expose:n,emit:l}){Ct.workerSrc=yt;const u=p(!1),v=p(null),g=p(""),d=p(!0),i=k,$=p(!1),N=p("#ffffff"),C=a=>{P.value.startsWith("blob:")&&URL.revokeObjectURL(P.value),document.getElementById(i.chatId).style.backgroundImage="none",document.getElementById(i.chatId).style.backgroundColor=a,localStorage.setItem(`${i.chatId}-bg-type`,"color"),localStorage.setItem(`${i.chatId}-bg`,a),P.value=a,$.value=!1},I=a=>{const t=document.querySelector(".bg-options-menu"),r=document.querySelector(".color-picker-container");!t.contains(a.target)&&!r.contains(a.target)&&($.value=!1)};R(()=>{document.addEventListener("click",I)}),Y(()=>{document.removeEventListener("click",I)});const S=()=>{F.value?_e():fe()},_e=()=>{if(u.value=!0,v.value){v.value.abort(),v.value=null;const t=y[A.value].messages.findLast(r=>r.sender==="agent"&&!r.finished);t&&(t.finished=!0,t.html=Z.parse(t.content))}g.value=""},ze=()=>{u.value=!1,fe(g.value)},z=ut("showToast"),ye=p(null),Ce=p(!1),E=p(i.mode),j=p([i.avatarPath]),K=p(0),x=p([]),O=p(""),F=p(!1),G=p("0.0s"),we=p(null),y=dt([]),A=p(0),T=p(null),me=p(!0),De=p(null),ne=p(!1),$e=p(""),ge=p(""),oe=p(""),pe=p(-1),le=p(!1),P=p(i.defaultBg),Ie=p(null),We=p(i.defaultBg),Te=vt(()=>`${i.chatId}-sessions`),Ge=()=>{try{const a=localStorage.getItem(Te.value);a&&(y.splice(0,y.length,...JSON.parse(a).map(t=>({...t,startTime:new Date(t.startTime),messages:t.messages.map(r=>({...r,timestamp:r.timestamp?new Date(r.timestamp):new Date}))}))),A.value=y.length>0?0:-1)}catch(a){console.error("读取会话失败:",a)}},Be=()=>{try{const a=y.map(t=>({...t,startTime:t.startTime.getTime(),messages:t.messages.map(r=>{var s;return{...r,timestamp:((s=r.timestamp)==null?void 0:s.getTime())||Date.now()}})}));localStorage.setItem(Te.value,JSON.stringify(a))}catch(a){console.error("保存会话失败:",a)}},Ve=()=>{localStorage.removeItem(`${i.chatId}-bg`),ie(i.defaultBg),z("已恢复默认背景")},ie=a=>{document.getElementById(i.chatId).style.backgroundColor="",P.value.startsWith("blob:")&&URL.revokeObjectURL(P.value),P.value=a,document.getElementById(i.chatId).style.backgroundImage=`url(${a})`,localStorage.setItem(`${i.chatId}-bg-type`,"image")},Qe=()=>{Ie.value.click()},Ke=a=>{const t=a.target.files[0];if(t){const r=new FileReader;r.onload=s=>{const m=s.target.result;ie(m),localStorage.setItem(`${i.chatId}-bg`,m)},r.readAsDataURL(t)}};Y(()=>{P.value.startsWith("blob:")&&URL.revokeObjectURL(P.value)}),R(()=>{const a=localStorage.getItem(`${i.chatId}-bg-type`),t=localStorage.getItem(`${i.chatId}-bg`);t?a==="color"?(document.getElementById(i.chatId).style.backgroundColor=t,document.getElementById(i.chatId).style.backgroundImage="none"):ie(t):ie(We.value)});const Ze=()=>{ne.value=!1,ge.value.startsWith("blob:")&&URL.revokeObjectURL(ge.value)},Xe=a=>{const t=URL.createObjectURL(a.raw),r=window.open(t,"_blank");setTimeout(()=>{if(!r||r.closed){z("请在浏览器设置中允许弹出窗口，或长按链接选择打开方式");const s=document.createElement("a");s.href=t,s.download=a.name,document.body.appendChild(s),s.click(),document.body.removeChild(s)}},500),r==null||r.addEventListener("beforeunload",()=>{URL.revokeObjectURL(t)})},Ye=(a,t)=>{const s=[];for(let c=0;c<a.length;c+=100)s.push(a.slice(c,c+100));const m=document.createDocumentFragment();return s.forEach(c=>{const h=document.createElement("span");h.textContent=c,m.appendChild(h)}),{safeContent:t+a,buffer:"",hasPendingCode:!1}},et=(a,t)=>{oe.value=a.content,pe.value=t,$e.value=`编辑内容 - ${a.name}`,le.value=!1,ne.value=!0},tt=()=>{pe.value>=0&&(x.value[pe.value].content=oe.value,ne.value=!1,z("修改已保存"))};R(async()=>{await qe.createWorker(),Ce.value=!0}),Y(async()=>{ye.value&&await ye.value.terminate()}),R(()=>{T.value&&T.value.addEventListener("scroll",re),y.length===0&&V()}),Y(()=>{T.value&&T.value.removeEventListener("scroll",re)});const Se=async(a,t)=>{try{if(a.type.startsWith("image/")){if(!Ce.value)throw new Error("OCR引擎初始化中，请稍后");const{data:{text:m}}=await qe.recognize(a);return m}if(a.type==="application/pdf"){const c=await wt({data:new Uint8Array(t)}).promise;let h="";for(let b=1;b<=c.numPages;b++){const ue=await(await c.getPage(b)).getTextContent();h+=ue.items.map(B=>B.str).join(`
`)+`
`}return h}if(a.name.endsWith(".docx"))return(await ht.extractRawText({arrayBuffer:t})).value.replace(/\n{3,}/g,`

`);if(a.name.endsWith(".pptx")){const m=new kt;return await m.load(t),m.slides.flatMap(c=>c.shapes.filter(h=>h.text).map(h=>h.text)).join(`

`)}const r=["utf-8","gbk","gb2312","big5","shift_jis","windows-1252"];let s="";for(const m of r)try{if(s=new TextDecoder(m,{fatal:!0}).decode(new Uint8Array(t)),!at(s))return s}catch{continue}return s.replace(/[^\x00-\x7F]/g,"")}catch(r){throw console.error("文件解析错误:",r),new Error(`文件解析失败: ${r.message}`)}},at=a=>/[\x00-\x08\x0B-\x0C\x0E-\x1F]/.test(a),xe=a=>{if(a===0)return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(a)/Math.log(t));return parseFloat((a/Math.pow(t,s)).toFixed(2))+" "+r[s]},Ae=async a=>{const t=Array.from(a.target.files);for(const r of t)try{const s={name:r.name,size:r.size,content:"",raw:r,icon:je(r.name),progress:0,status:"解析中...",isExpanded:!1};x.value.push(s);const m=await Ue(r,c=>{s.progress=Math.floor(c*100)});s.content=m,s.status="解析完成",s.progress=100}catch(s){fileItem.status=`解析失败: ${s.message}`,fileItem.progress=0,z(`${r.name} 处理失败: ${s.message}`)}a.target.value=""},Ue=(a,t)=>new Promise((r,s)=>{const m=new FileReader;let c=0;m.onprogress=h=>{if(h.lengthComputable){const b=h.loaded/h.total;b-c>.05&&(t==null||t(b),c=b)}},m.onload=async h=>{try{const b=await Se(a,h.target.result);r(b)}catch(b){s(b)}},m.onerror=s,m.readAsArrayBuffer(a)}),je=a=>{const t=a.split(".").pop().toLowerCase();return`fas ${{pdf:"fa-file-pdf",jpg:"fa-file-image",png:"fa-file-image",doc:"fa-file-word",docx:"fa-file-word",ppt:"fa-file-powerpoint",pptx:"fa-file-powerpoint",txt:"fa-file-alt"}[t]||"fa-file"}`},He=a=>{x.value.splice(a,1)};function V(){y.push({id:y.length,messages:[],startTime:new Date,avatar:j.value[K.value]}),A.value=y.length-1,Q(ce)}function Je(a){A.value=a,Q(ce)}function Me(a){return/```[\s\S]*?```/g.test(a)}function Le(a){const t=a.match(/```[\s\S]*?```/g);return t?t.map(r=>r.replace(/```[\s\S]*?\n/,"").replace(/```$/,"")):[]}async function Ne(a){try{await navigator.clipboard.writeText(a),z("代码已复制到剪贴板！")}catch{z("复制失败，请手动选择复制")}}async function Ee(a=""){if(u.value){ze();return}const t=y[A.value],r=t.messages.flatMap(c=>{var b;const h=c.sender==="user"?{role:"user",content:c.content+((b=c.files)!=null&&b.length?`
[附件内容]
`+c.files.map(D=>D.content).join(`
`):"")}:{role:"assistant",content:c.content};return i.selectedAgents.length>=2?[h]:c.sender==="user"?[h]:[]});let s="";if(i.selectedAgents.length>1)s=r.map(c=>`${c.role==="user"?"[用户]":`[${E.value}]`} ${c.content}`).join(`

`);else{const c=O.value.trim(),h=x.value.map(b=>b.content.trim()).join(`

`);s=[c,h].filter(b=>b.length>0).join(`

`)}if(!s.trim()){z("请输入内容或上传文件");return}!a&&i.selectedAgents.length<2&&t.messages.push({sender:"user",content:O.value,files:[...x.value]}),v.value=new AbortController,F.value=!0,u.value=!1;let m=a;st();try{const c=await fetch(Sa,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inputText:s,agentMode:E.value,history:r,currentAgent:E.value}),signal:v.value.signal});if(!c.ok)throw new Error(await c.text());const h=c.body.getReader(),b=new TextDecoder;let D="",ue=!0,B=null,Oe="",Fe=!1;for(;!u.value;){const{done:lt,value:it}=await h.read();if(lt)break;D+=b.decode(it,{stream:!0});const Pe=D.split(`
`);D=Pe.pop()||"";for(const Re of Pe){if(!Re.trim())continue;const he=JSON.parse(Re);if(he.error)throw new Error(he.error);const ke=Ye(he.content,Oe),rt=ke.safeContent;Oe=ke.buffer,Fe=ke.hasPendingCode,ue&&(B={sender:"agent",content:"",html:'<span class="blinking-cursor">|</span>',avatar:j.value[K.value],finished:!1,agentMode:E.value},t.messages.push(B),ue=!1),m+=rt,g.value=m,B.content=m,Fe?B.html=Z.parse(m+"```")+'<span class="blinking-cursor">|</span><div class="pending-code">代码生成中...</div>':(B.html=Z.parse(m)+'<span class="blinking-cursor">|</span>',window.MathJax&&window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,T.value])),await Q(),ce(),window.MathJax&&window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,T.value])}}B&&(typeof m=="string"&&(B.html=Z.parse(m).replace('<span class="blinking-cursor">|</span>',""),B.content=m,B.rawContent=m),B.time=G.value,B.finished=!0)}catch(c){c.name!=="AbortError"||console.log("请求已中止")}finally{i.selectedAgents.length<2&&(O.value="",x.value=[]),ot(),F.value=!1,v.value=null,g.value="",await Q(),u.value=!1,window.MathJax&&window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,T.value])}}async function fe(){if(i.selectedAgents.length>=2){const a=y[A.value];a.messages.push({sender:"user",content:O.value,files:[...x.value]});let t=[...a.messages];for(let r=0;r<i.selectedAgents.length;r++){E.value=i.selectedAgents[r];const s=`/NJUtianchiAI_HCkotobahitomi0/avatar/${E.value}.jpg`;j.value.includes(s)||(j.value=[s]),K.value=j.value.indexOf(s),t.map(c=>({role:c.sender==="user"?"user":"assistant",content:c.sender==="agent"?c.rawContent:c.content})),await Ee("");const m=a.messages[a.messages.length-1];t.push(m)}}else{if(i.selectedAgents.length==1){E.value=i.selectedAgents[0];const a=`/NJUtianchiAICabbageTeam/avatar/${E.value}.jpg`;j.value.includes(a)||(j.value=[a]),K.value=j.value.indexOf(a)}Ee()}O.value="",x.value=[]}function st(){let a=Date.now();G.value="0.0s",we.value=setInterval(()=>{G.value=((Date.now()-a)/1e3).toFixed(1)+"s"},100)}function nt(a){y.length>1?A.value=a>0?a-1:0:V(),y.splice(a,1),y.length===0&&V(),Be()}function ot(){clearInterval(we.value),G.value="0.0s"}function re(){const a=T.value;a&&(me.value=a.scrollHeight-a.scrollTop-a.clientHeight<2)}const ce=()=>{if(!T.value||!me.value)return;const a=T.value;requestAnimationFrame(()=>{a.scrollTop=a.scrollHeight})};return de(()=>y,a=>{Be()},{deep:!0}),R(()=>{Ge(),y.length===0&&V()}),de(()=>{var a;return(a=y[A.value])==null?void 0:a.messages.length},async()=>{await Q(),window.MathJax&&T.value&&window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,T.value])}),n({isThinking:F,thinkingTime:G,sessions:y,activeSessionIndex:A,chatHistoryRef:T,files:x,inputText:O,handleFileUpload:Ae,removeFile:He,createNewChat:V,switchToSession:Je,scrollToBottom:ce,formatFileSize:xe,getFileIcon:je,parseAnyFile:Se,readFileContent:Ue,hasCodeBlocks:Me,getCodeBlocks:Le,copyToClipboard:Ne,onChatHistoryScroll:re,autoScroll:me}),(a,t)=>{var r;return o(),f("section",{id:k.chatId,class:"screen"},[ne.value?(o(),f("div",Pt,[e("div",Rt,[e("span",{class:"close",onClick:Ze},"×"),e("h3",null,w($e.value),1),le.value?(o(),f("img",{key:0,src:ge.value,class:"file-preview-image"},null,8,qt)):L((o(),f("textarea",{key:1,"onUpdate:modelValue":t[0]||(t[0]=s=>oe.value=s),class:"file-content-editor",placeholder:le.value?"图片不可编辑":"在此编辑文件内容"},null,8,zt)),[[be,oe.value]]),le.value?U("",!0):(o(),f("button",{key:2,class:"anime-btn save-btn",onClick:tt}," 保存 "))])])):U("",!0),e("div",Dt,[e("div",Wt,[e("button",{class:"anime-btn back-btn",onClick:t[1]||(t[1]=s=>a.$emit("back"))},t[10]||(t[10]=[e("i",{class:"fas fa-arrow-left"},null,-1)]))]),e("div",Gt,[L(e("button",{class:"expand-btn",onClick:t[2]||(t[2]=s=>d.value=!d.value)},t[11]||(t[11]=[e("i",{class:"fas fa-chevron-right"},null,-1)]),512),[[ae,d.value]])]),te(ve,{name:"slide"},{default:se(()=>[L(e("div",Vt,[e("div",Qt,[t[19]||(t[19]=e("h3",null,"历史",-1)),e("button",{class:"anime-btn",onClick:V},t[12]||(t[12]=[e("i",{class:"fas fa-plus"},null,-1)])),e("button",{class:"anime-btn",onClick:t[3]||(t[3]=M(s=>$.value=!$.value,["stop"])),title:"背景设置"},t[13]||(t[13]=[e("i",{class:"fas fa-palette"},null,-1)])),te(ve,{name:"fade"},{default:se(()=>[$.value?(o(),f("div",Kt,[e("div",{class:"bg-option",onClick:Qe},[t[14]||(t[14]=e("i",{class:"fas fa-image"},null,-1)),t[15]||(t[15]=X(" 自定义背景 ")),e("input",{type:"file",ref_key:"bgInput",ref:Ie,accept:"image/*",onChange:Ke,style:{display:"none"}},null,544)]),e("div",{class:"bg-option",onClick:Ve},t[16]||(t[16]=[e("i",{class:"fas fa-undo"},null,-1),X(" 恢复默认 ")])),e("div",{class:"color-picker-container",onClick:t[6]||(t[6]=M(()=>{},["stop"]))},[L(e("input",{type:"color","onUpdate:modelValue":t[4]||(t[4]=s=>N.value=s),onInput:t[5]||(t[5]=M(s=>C(N.value),["stop"])),class:"color-picker"},null,544),[[be,N.value]]),e("div",{class:"color-preview",style:mt({background:N.value})},null,4),t[17]||(t[17]=X(" 自定义颜色 "))])])):U("",!0)]),_:1}),e("button",{class:"collapse-btn",onClick:t[7]||(t[7]=s=>d.value=!d.value)},t[18]||(t[18]=[e("i",{class:"fas fa-chevron-left"},null,-1)]))]),e("div",Zt,[e("div",Xt,[(o(!0),f(H,null,q(y,(s,m)=>{var c,h;return o(),f("div",{key:s.id,class:ee(["session-item",{active:m===A.value}]),onClick:b=>Je(m)},[e("div",null," 会话 "+w(m+1)+": "+w((h=(c=s.messages[s.messages.length-1])==null?void 0:c.content)==null?void 0:h.slice(0,20)),1),e("div",ea,w(s.startTime.toLocaleTimeString()),1),e("button",{class:"delete-session-btn",title:"清空本会话",onClick:M(b=>nt(m),["stop"])},t[20]||(t[20]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,ta)],10,Yt)}),128))])])],512),[[ae,!d.value]])]),_:1})]),e("div",aa,[gt(a.$slots,"righttop",{},void 0)]),e("h1",null,w(k.chatTitle),1),t[26]||(t[26]=e("div",{class:"leftbottom-container"},null,-1)),e("div",sa,[te(Ot,{show:F.value,avatar:j.value[K.value],time:G.value},null,8,["show","avatar","time"]),e("div",{class:"chat-history",ref_key:"chatHistoryRef",ref:T,onScroll:re},[(o(!0),f(H,null,q((r=y[A.value])==null?void 0:r.messages,(s,m)=>{var c;return o(),f(H,{key:m},[s.sender==="user"?(o(),f("div",na,[(c=s.files)!=null&&c.length?(o(),f("div",oa,[(o(!0),f(H,null,q(s.files,(h,b)=>(o(),f("div",{key:b,class:"file-tag"},[e("i",{class:ee(h.icon)},null,2),X(" "+w(h.name),1)]))),128))])):U("",!0),e("div",la,w(s.content),1)])):(o(),f("div",ia,[e("img",{src:s.avatar||j.value[0],class:"agent-avatar"},null,8,ra),e("div",ca,[e("div",{class:"stream-content",innerHTML:s.rawContent?pt(Z).parse(s.rawContent):s.html},null,8,ua),Me(s.content)?(o(!0),f(H,{key:0},q(Le(s.content),(h,b)=>(o(),f("div",{class:"code-copy-container",key:b},[e("pre",null,[e("code",null,w(h),1)]),e("button",{class:"copy-btn",onClick:D=>Ne(h),title:"复制代码"},t[21]||(t[21]=[e("i",{class:"fas fa-copy"},null,-1)]),8,da)]))),128)):U("",!0)])]))],64)}),128))],544),x.value.length>0?(o(),f("div",va,[(o(!0),f(H,null,q(x.value,(s,m)=>(o(),f("div",{key:m,class:ee(["file-card",{expanded:s.isExpanded}])},[e("div",ma,[e("i",{class:ee(s.icon)},null,2),e("div",ga,[e("span",pa,w(s.name),1),e("span",fa,w(xe(s.size)),1)]),e("div",ha,[e("button",{class:"action-btn view-btn",onClick:M(c=>Xe(s),["stop"])},t[22]||(t[22]=[e("i",{class:"fas fa-eye"},null,-1)]),8,ka),e("button",{class:"action-btn edit-btn",onClick:M(c=>et(s,m),["stop"])},t[23]||(t[23]=[e("i",{class:"fas fa-edit"},null,-1)]),8,ba),e("button",{class:"action-btn delete-btn",onClick:M(c=>He(m),["stop"])},t[24]||(t[24]=[e("i",{class:"fas fa-times"},null,-1)]),8,_a)])])],2))),128))])):U("",!0),e("div",ya,[L(e("textarea",{id:"text-input-field","onUpdate:modelValue":t[8]||(t[8]=s=>O.value=s),placeholder:"请输入...",onKeypress:ft(M(fe,["prevent"]),["enter"]),disabled:F.value},null,40,Ca),[[be,O.value]]),e("div",wa,[e("input",{type:"file",class:"tool-btn",style:{display:"none"},ref_key:"fileInput",ref:De,onChange:Ae,multiple:"",accept:"*/*"},null,544),e("button",{class:"tool-btn",onClick:t[9]||(t[9]=s=>a.$refs.fileInput.click()),disabled:F.value},t[25]||(t[25]=[e("i",{class:"fas fa-file-upload"},null,-1)]),8,$a),e("button",{class:"tool-btn",onClick:S},[F.value?(o(),f("i",Ia)):k.selectedAgents.length>=2?(o(),f("i",Ta)):(o(),f("i",Ba))])])])])],8,Ft)}}},J=W(xa,[["__scopeId","data-v-7945176f"]]),Aa={class:"agent-sidebar"},Ua={class:"sessions-header"},ja={class:"sidebar-header-row"},Ha={class:"agent-list"},Ja=["onClick"],Ma=["src"],La={key:0,class:"selected-indicator"},Na={class:"agent-info"},Ea={class:"agent-name"},Oa={class:"agent-mode"},Fa={key:1,class:"fas fa-check selected-icon"},Pa={__name:"GroupDiscussionChat",emits:["back"],setup(k,{emit:n}){const l=p(!0);function u(){l.value=!l.value}const v=p(null),g=p([]),d=p([{mode:"soul",name:"心灵导师",avatar:"/NJUtianchiAI_HCkotobahitomi0/avatar/soul.jpg"},{mode:"misheard",name:"空耳专家",avatar:"/NJUtianchiAI_HCkotobahitomi0/avatar/misheard.jpg"},{mode:"correction",name:"语法医生",avatar:"/NJUtianchiAI_HCkotobahitomi0/avatar/correction.jpg"},{mode:"stem",name:"科学大家",avatar:"/NJUtianchiAI_HCkotobahitomi0/avatar/stem.jpg"},{mode:"culture",name:"文化学者",avatar:"/NJUtianchiAI_HCkotobahitomi0/avatar/culture.jpg"},{mode:"dialect",name:"方言达人",avatar:"/NJUtianchiAI_HCkotobahitomi0/avatar/dialect.jpg"},{mode:"super-translate",name:"翻译大师",avatar:"/NJUtianchiAI_HCkotobahitomi0/avatar/super-translate.jpg"},{mode:"game-misheard",name:"空耳游戏王",avatar:"/NJUtianchiAI_HCkotobahitomi0/avatar/game-misheard.jpg"},{mode:"game-word",name:"字词专家",avatar:"/NJUtianchiAI_HCkotobahitomi0/avatar/game-word.jpg"}]),i=p(new AbortController),$=C=>g.value.includes(C),N=C=>{const I=g.value.indexOf(C);I>-1?g.value.splice(I,1):g.value.length<9&&g.value.push(C),g.value=[...g.value],v.value.selectedAgents=[...g.value]};return R(()=>{Q(()=>{var C,I;((I=(C=v.value)==null?void 0:C.sessions)==null?void 0:I.length)===0&&v.value.createNewChat()})}),Y(()=>{var C;(C=i.value)==null||C.abort()}),de(g,C=>{localStorage.setItem("group-selected-agents",JSON.stringify(C))}),R(()=>{const C=localStorage.getItem("group-selected-agents");C&&(g.value=JSON.parse(C),v.value.selectedAgents=[...g.value])}),(C,I)=>(o(),_(J,{ref_key:"baseChat",ref:v,chatId:"group-discussion",chatTitle:"多体讨论 ("+g.value.length+"/9)",defaultBg:"/NJUtianchiAI_HCkotobahitomi0/bg/groupdiscussion-bg.jpg",mode:"zero",selectedAgents:g.value,avatarPath:"/NJUtianchiAI_HCkotobahitomi0/avatar/zero.gif",onBack:I[0]||(I[0]=S=>C.$emit("back"))},{righttop:se(()=>[te(ve,{name:"slide"},{default:se(()=>[L(e("div",Aa,[e("div",Ua,[e("div",ja,[e("button",{class:"collapse-btn",onClick:u},I[1]||(I[1]=[e("i",{class:"fas fa-chevron-right"},null,-1)])),e("h2",null,"讨论成员（"+w(g.value.length)+"/9）",1)])]),e("div",Ha,[(o(!0),f(H,null,q(d.value,S=>(o(),f("div",{key:S.mode,class:ee(["agent-item",{selected:$(S.mode)}]),onClick:_e=>N(S.mode)},[e("img",{src:S.avatar,class:"agent-avatar"},null,8,Ma),$(S.mode)?(o(),f("div",La)):U("",!0),e("div",Na,[e("span",Ea,w(S.name),1),e("span",Oa,w(S.mode),1)]),$(S.mode)?(o(),f("i",Fa)):U("",!0)],10,Ja))),128))])],512),[[ae,!l.value]])]),_:1}),L(e("button",{class:"expand-btn",onClick:u},I[2]||(I[2]=[e("i",{class:"fas fa-chevron-left"},null,-1)]),512),[[ae,l.value]])]),_:1},8,["chatTitle","selectedAgents"]))}},Ra=W(Pa,[["__scopeId","data-v-f6c727bb"]]),qa={__name:"SoulChat",setup(k){return(n,l)=>(o(),_(J,{chatId:"soul-chat",chatTitle:"心灵空间",defaultBg:"/NJUtianchiAI_HCkotobahitomi0/bg/soul-bg.jpg",avatarPath:"/NJUtianchiAI_HCkotobahitomi0/avatar/soul.jpg",mode:"soul",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},za={__name:"MisheardChat",setup(k){return(n,l)=>(o(),_(J,{chatId:"misheard-chat",chatTitle:"空耳查询",defaultBg:"/bg/misheard-bg.jpg",avatarPath:"/avatar/misheard.jpg",mode:"misheard",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},Da={__name:"CorrectionChat",setup(k){return(n,l)=>(o(),_(J,{chatId:"correction-chat",chatTitle:"语言纠错",defaultBg:"/NJUtianchiAI_HCkotobahitomi0/bg/correction-bg.jpg",avatarPath:"/NJUtianchiAI_HCkotobahitomi0/avatar/correction.jpg",mode:"correction",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},Wa={class:"toast show"},Ga={class:"toast-content"},Va={__name:"Toast",props:["message"],setup(k){return(n,l)=>(o(),f("div",Wa,[e("div",Ga,w(k.message),1)]))}},Qa=W(Va,[["__scopeId","data-v-9f189b94"]]),Ka={__name:"GameMisheardChat",setup(k){return(n,l)=>(o(),_(J,{chatId:"game-misheard-chat",chatTitle:"空耳挑战",defaultBg:"/NJUtianchiAI_HCkotobahitomi0/bg/game-misheard-bg.jpg",avatarPath:"/NJUtianchiAI_HCkotobahitomi0/avatar/game-misheard.jpg",mode:"game-misheard",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},Za={__name:"GameWordChat",setup(k){return(n,l)=>(o(),_(J,{chatId:"game-word-chat",chatTitle:"字音快对",defaultBg:"/NJUtianchiAI_HCkotobahitomi0/bg/game-word-bg.jpg",avatarPath:"/NJUtianchiAI_HCkotobahitomi0/avatar/game-word.jpg",mode:"game-word",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},Xa={__name:"CultureChat",setup(k){return(n,l)=>(o(),_(J,{chatId:"culture-chat",chatTitle:"文化探索",defaultBg:"/NJUtianchiAI_HCkotobahitomi0/bg/culture-bg.jpg",avatarPath:"/NJUtianchiAI_HCkotobahitomi0/avatar/culture.jpg",mode:"culture",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},Ya={__name:"DialectChat",setup(k){return(n,l)=>(o(),_(J,{chatId:"dialect-chat",chatTitle:"方言探索",defaultBg:"/NJUtianchiAI_HCkotobahitomi0/bg/dialect-bg.jpg",avatarPath:"/NJUtianchiAI_HCkotobahitomi0/avatar/dialect.jpg",mode:"dialect",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},es={__name:"SuperTranslateChat",setup(k){return(n,l)=>(o(),_(J,{chatId:"super-translate-chat",chatTitle:"超能翻译",defaultBg:"/bg/super-translate-bg.jpg",avatarPath:"/avatar/super-translate.jpg",mode:"super-translate",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},ts={class:"screen quick-chat-screen",id:"quick-chat"},as={class:"lefttop-container"},ss={class:"chat-grid"},ns=["onClick"],os={class:"chat-icon"},ls={class:"chat-title"},is={__name:"QuickChatScreen",setup(k){const n=[{type:"soul",title:"心灵空间",icon:"💌"},{type:"misheard",title:"空耳查询",icon:"🎧"},{type:"correction",title:"语言纠错",icon:"📝"},{type:"dialect",title:"方言探索",icon:"🗺️"},{type:"super-translate",title:"超能翻译",icon:"🚀"},{type:"culture",title:"文化探索",icon:"🎎"},{type:"game-misheard",title:"空耳挑战",icon:"🎮"},{type:"game-word",title:"字音快对",icon:"🔠"},{type:"stem",title:"科学世界",icon:"🧪"}];return(l,u)=>(o(),f("section",ts,[e("div",as,[e("button",{class:"anime-btn",onClick:u[0]||(u[0]=v=>l.$emit("back"))},u[1]||(u[1]=[e("i",{class:"fas fa-arrow-left"},null,-1)]))]),e("div",ss,[(o(),f(H,null,q(n,(v,g)=>e("div",{key:g,class:"chat-item anime-btn",onClick:d=>l.$emit("select-chat",v.type)},[e("div",os,w(v.icon),1),e("div",ls,w(v.title),1)],8,ns)),64))])]))}},rs=W(is,[["__scopeId","data-v-6a0862ae"]]),cs={__name:"STEMChat",setup(k){return(n,l)=>(o(),_(J,{chatId:"stem-chat",chatTitle:"科学世界",defaultBg:"/bg/stem-bg.jpg",avatarPath:"/avatar/stem.jpg",mode:"stem",onBack:l[0]||(l[0]=u=>n.$emit("back"))}))}},us={__name:"App",setup(k){const n=p("welcome"),l=p({show:!1,message:""}),u=g=>{n.value=g};function v(g){l.value={show:!0,message:g},setTimeout(()=>l.value.show=!1,3e3)}return bt("showToast",v),(g,d)=>(o(),f(H,null,[te(ve,{name:"anime-fade-cross"},{default:se(()=>[n.value==="welcome"?(o(),_(Jt,{onStart:d[0]||(d[0]=i=>n.value="group-discussion"),onQuickChat:d[1]||(d[1]=i=>n.value="quick-chat"),key:"welcome"})):n.value==="group-discussion"?(o(),_(Ra,{key:1,onBack:d[2]||(d[2]=i=>n.value="welcome")})):n.value==="soul"?(o(),_(qa,{key:2,onBack:d[3]||(d[3]=i=>n.value="quick-chat")})):n.value==="misheard"?(o(),_(za,{key:3,onBack:d[4]||(d[4]=i=>n.value="quick-chat")})):n.value==="correction"?(o(),_(Da,{key:4,onBack:d[5]||(d[5]=i=>n.value="quick-chat")})):n.value==="game-misheard"?(o(),_(Ka,{key:5,onBack:d[6]||(d[6]=i=>n.value="quick-chat")})):n.value==="game-word"?(o(),_(Za,{key:6,onBack:d[7]||(d[7]=i=>n.value="quick-chat")})):n.value==="culture"?(o(),_(Xa,{key:7,onBack:d[8]||(d[8]=i=>n.value="quick-chat")})):n.value==="dialect"?(o(),_(Ya,{key:8,onBack:d[9]||(d[9]=i=>n.value="quick-chat")})):n.value==="super-translate"?(o(),_(es,{key:9,onBack:d[10]||(d[10]=i=>n.value="quick-chat")})):n.value==="stem"?(o(),_(cs,{key:10,onBack:d[11]||(d[11]=i=>n.value="quick-chat")})):n.value==="quick-chat"?(o(),_(rs,{key:11,onBack:d[12]||(d[12]=i=>n.value="welcome"),onSelectChat:u})):U("",!0)]),_:1}),l.value.show?(o(),_(Qa,{key:0,message:l.value.message},null,8,["message"])):U("",!0)],64))}};_t(us).mount("#app");
